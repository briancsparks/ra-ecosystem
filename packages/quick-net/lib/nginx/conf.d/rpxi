
  #
  # Put these lines (with a corrected proxy_pass value) AFTER you include this file.
  #
  # location / {
  #   try_files maintenance.html $uri $uri/ $uri.html @router
  # }
  #
  # location @router {
  #   internal;
  #   include /etc/nginx/conf.d/proxy-params;
  #
  #   proxy_pass http://10.13.1.10:8401;
  # }
  #
  # ------
  # Then respond with X-Accel-Redirect header:
  #
  #   "X-Accel-Redirect": "/rpxi/GET/path/to/resource"
  #

  # "X-Accel-Redirect": "/rpxi/GET/path/to/resource"
  location ~* ^/rpxi/GET/(.*) {
    internal;

    include /etc/nginx/conf.d/rpxi-proxy-params;

    proxy_http_version                    1.1;
    proxy_method                          GET;
    set $other_uri                        $1;

    proxy_pass http://$other_uri$is_args$args;
  }

  # "X-Accel-Redirect": "/rpxi/PUT/path/to/resource"
  location ~* ^/rpxi/PUT/(.*) {
    internal;

    include /etc/nginx/conf.d/rpxi-proxy-params;

    proxy_http_version                    1.1;
    proxy_method                          PUT;
    set $other_uri                        $1;

    proxy_pass http://$other_uri$is_args$args;
  }

  # "X-Accel-Redirect": "/rpxi/POST/path/to/resource"
  location ~* ^/rpxi/POST/(.*) {
    internal;

    include /etc/nginx/conf.d/rpxi-proxy-params;

    proxy_http_version                    1.1;
    proxy_method                          POST;
    set $other_uri                        $1;

    proxy_pass http://$other_uri$is_args$args;
  }

  # "X-Accel-Redirect": "/rpxi/HEAD/path/to/resource"
  location ~* ^/rpxi/HEAD/(.*) {
    internal;

    include /etc/nginx/conf.d/rpxi-proxy-params;

    proxy_http_version                    1.1;
    proxy_method                          HEAD;
    set $other_uri                        $1;

    proxy_pass http://$other_uri$is_args$args;
  }

  # "X-Accel-Redirect": "/rpxi/DELETE/path/to/resource"
  location ~* ^/rpxi/DELETE/(.*) {
    internal;

    include /etc/nginx/conf.d/rpxi-proxy-params;

    proxy_http_version                    1.1;
    proxy_method                          DELETE;
    set $other_uri                        $1;

    proxy_pass http://$other_uri$is_args$args;
  }





  # "X-Accel-Redirect": "/int/GET/path/to/resource"
  #
  # Fetches from localhost. Does not ever use the local disk.
  #
  location ~* ^/int/GET/(.*) {
    internal;

    include /etc/nginx/conf.d/cache-proxy-params;

    set $download_uri $1;

    proxy_pass http://127.0.0.1/$download_uri$is_args$args;
  }


  # "X-Accel-Redirect": "/int/GET/www.example.com/path/to/resource"
  #
  # Fetches from download_host. Does not ever use the local disk.
  #
  location ~* ^/int/GET/(.*)/(.*) {
    internal;

    include /etc/nginx/conf.d/cache-proxy-params;

    set $download_host $1;
    set $download_path $2;

    proxy_pass http://$download_host/$download_path$is_args$args;
  }


  # "X-Accel-Redirect": "/int/GET/www.example.com/path/to/resource"
  #
  # Fetches from download_host. Does not ever use the local disk.
  #
  location ~* ^/secret_external_rev_proxy/(.*?)/(.*) {
    internal;

    include /etc/nginx/conf.d/cache-proxy-params;

    set $download_host $1;
    set $download_uri $2;
    set $download_url http://$download_host/$download_uri;

    proxy_set_header Host $download_host;

    proxy_pass $download_url$is_args$args;
  }



# vim: ft=nginx:

